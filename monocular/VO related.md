### 7.1.1 特征点
相比于朴素的角点，这些人工设计的特征点能够拥有如下性质：
1. 可重复性（Repeatability）：相同的特征可以在不同的图像中找到。
2. 可区别性（Distinctiveness）：不同的特征有不同的表达。
3. 高效率（Efficiency）：同一图像中，特征点的数量应远小于像素的数量。
4. 本地性（Locality）：特征仅与一小片图像区域相关。

描述子是按照“外观相似的特征应该有相似的描述子”的原则设计的。

### 7.1.2 ORB特征
**FAST关键点**

**BRIEF描述子**

***

## 7.3 2D-2D：对极几何
### 7.3.1 对极约束
![](/monocular/img/duiou.png)
同时，如果不知道P的位置，那么当我们在第二幅图像上看时，连线e<sub>2</sub>p<sub>2</sub>（也就是第二幅图像中的极线）就是P可能出现的投影位置，也就是射线O<sub>1</sub>p<sub>1</sub>在第二个相机中的投影。

基础矩阵(Fundamental Matrix)F 和本质矩阵(Essential Matrix)E
<br> 相机内参在SLAM中通常是已知的，在SfM研究中则有可能是未知且有待估计的

$$E=t^{\wedge }R,   F=K^{-T}EK^{-1}=K^{-T}t^{\wedge }RK^{-1}$$          
### 7.3.2 本质矩阵
E实际上有5个自由度

八点法  
Improve accuracy of 8-point algorithm [Har97]

奇异值分解本质矩阵，得到t与R
<br> 引入谱定理
<br> t的方向是奇异值0对应的奇异向量

### 7.3.3 单应矩阵
单应矩阵通常描述处于**共同平面**上的一些点在两张图像之间的变换关系。
<br> 这些情况在无人机携带的俯视相机或扫地机携带的顶视相机中比较常见。

$$ H=K(R-\frac{tn^{T}}{d})K^{-1}  $$

于是自由度为8的单应矩阵可以通过4对匹配特征点算出（在非退化的情况下，即这些特征点不能有三点共线的情况）
<br> 直接线性变换法

分解的方法包括数值法和解析法

当特征点共面或者相机发生纯旋转时，基础矩阵的自由度下降，这就出现了所谓的退化（degenerate）。
***

## 7.5 三角测量
通过三角测量（Triangulation）（或三角化）的方法估计地图点的深度  
三角测量是指，通过不同位置对同一个路标点进行观察，从观察到的位置推断路标点的距离。

![](/monocular/img/7.5.jpeg)

当然，由于噪声的存在，我们估计得的R,t不一定精确使上式为零，所以更常见的做法是求最小二乘解而不是直接的解。
<br> [[学习SLAM ]单目vo中的深度确定方法--三角测量](https://blog.csdn.net/KYJL888/article/details/107222533)

**三角测量是由平移得到的，有平移才会有对极几何中的三角形，才谈得上三角测量。**  
仅旋转光心位置没有发生改变，还是同一条极线。  
总而言之， 增大平移，可能导致匹配失效；而平移太小，则三角化精度不够。我们把这个问题称为“视差”（parallax）。
***
## 7.7 3D-2D: PnP
如果两张图像中的一张特征点的3D位置已知，那么最少只需3个点对（以及至少一个额外点验证结果）就可以估计相机运动。  
特征点的3D位置可以由三角化或者RGB-D相机的深度图确定。而在单目视觉里程计中，必须先进行初始化，才能使用PnP。

### 7.7.1 直接线性变换（DLT）
t一共有12维，因此最少通过6对匹配点即可实现矩阵T的线性求解，这种方法称为DLT。当匹配点大于6对时，也可以使用SVD等方法对超定方程求最小二乘解。
***
## PTAM related
[Parallel Tracking And Mapping (PTAM) 特征点法 fast角点+灰度块匹配 2d-2d单应变换](https://github.com/Ewenwan/MVision/tree/master/vSLAM/PTAM)

2、PTAM是第一个使用 非线性优化，而不是使用传统的 滤波器 作为后端的方案。
它引入了关键帧机制：我们不必精细地处理每一幅图像，而是把几个关键图像串起来，然后优化其轨迹和地图。

ORB-SLAM就是继承并改进PTAM的

具体而言:
1. 姿态跟踪线程 不修改地图，只是利用已知地图来快速跟踪；
2. 而在建立 地图线程 专注于地图的建立、维护和更新。  

但很现实的问题是如果地图建立或优化过慢，跟踪线程很容易会因为没有最新的地图或者没有优化过的地图而跟丢。
<br> <font color=red>？</font> 另外比较实际的工程问题是地图线程的最新地图数据应该lock 还是 copy data between threads 以及threading的实现质量。

PTAM主要分为这几部分：
1) **Track线程**
1. 金字塔分层，FAST特征提取
(对图片构造金字塔的目的有两个：1）加快匹配；2）提高地图点相对于相机远近变化时的鲁棒性)
(FAST是常用的特征点，优点是快，缺点是不鲁棒.通常先提取出大量匹配点，后使用SSD快匹配，剔除误匹配)
2. 地图初始化
3. 跟踪定位 （极线几何与极线搜索， RANSAC（随机采样一致）及N点算法（主要围绕5点算法））
4. 选取添加关键帧到缓存队列
5. 重定位(每帧高斯模糊小图SSD相似度匹配)
2) **Map线程**
6. 先五点法加RANSAC求出初值
7. 局部BundleAdjustment
8. 全局BundleAdjustment
9. 从缓存队列取出关键帧到地图
10. 极线搜索加点到地图

另一方面，按照一般的视觉SLAM框架，PTAM也可分为
1) 传感器数据获取（摄像头输入图像数据）
2) 前端视觉里程计（跟踪定位、重定位）
3) 后端优化（Bundle Adjustment）
4) 建图（极线搜索加点）
5) 没有回环检测

缺点：场景小，跟踪容易丢失。

![](/monocular/img/ptam1.png)

[PTAM跟踪过程中的旋转预测方法](https://zhuanlan.zhihu.com/p/20302059?refer=computercoil)
<br> PTAM在进行跟踪的每一帧都会首先调用一个CalcSBIRotation的方法，最开始读PTAM代码我总是很疑惑这个方法的作用。最后发现这个方法会计算一下当前帧相对于上一帧的Rotation。也就是旋转角度。计算完毕后再根据这个旋转角度进行调整，然后使用基于SSD的跟踪算法。因为预先计算了Rotation，当然SSD的结果也就会更加准确。当用户旋转摄像头的时候也就更加不容易丢失跟踪目标。

此方法采用的跟踪算法为 ESM 跟踪算法。

***

## 相机标定/失真校正  
"Straight lines have to be straight"
$$ r=\sqrt{\frac{x^{2}+y^{2}  }{z^{2} } } $$
$$ r'=\frac{1}{\omega }\arctan (2r\tan \frac{\omega}{2} ) $$
系数 $\frac{r'}{r}$
